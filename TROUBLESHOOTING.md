# トラブルシューティング記録

## 問題: Remotion Studio画面が真っ黒 (Black Screen of Death)

### 現象
- `npm run dev` でStudioは立ち上がるが、プレビュー画面が完全に真っ黒。
- ブラウザのコンソールにはReactのエラー ("An error occurred in the <InnerComposition> component") が出るが、詳細なスタックトレースがなく原因特定が困難。
- `window` オブジェクトなどは生きており、アプリ自体はロードされている。

### 迷走ルート (Trap)
1.  **フォント読み込み疑い**: 非同期処理 (`opentype.js`) でフリーズしていると思い込み、`continueRender` の処理を追加修正したが解決せず。
2.  **ブラウザ機能疑い**: エラーオーバーレイが表示されないバグを疑った。

### 真の原因 (Root Cause)
- **Composition ID の命名規則違反**
- `src/Root.tsx` 内で `<Composition id="MyComp_PlanB" ... />` のように **アンダースコア ( `_` )** を使用していた。
- **仕様**: RemotionのComposition IDで使用できるのは `a-z`, `A-Z`, `0-9`, `-` (ハイフン) のみ。アンダースコアは許可されていない。

### 解決策 (Solution)
- IDをハイフン区切りに変更した。
    - ❌ `MyComp_PlanB`
    - ✅ `MyComp-PlanB`

---

## 💡 学びと教訓 (Lessons Learned)

### 1. UIが死んだら、CLIに聞け (Ask the CLI)
ブラウザのReactエラー境界 (Error Boundary) がクラッシュして何も表示されない時は、ターミナルからレンダリングコマンドを叩くと、生の例外エラーが見られる。
今回もこれで一発解決した。

```bash
# これを実行すればよかった
npx remotion render src/index.ts MyComp out/debug.mp4 --frames=0
```

### 2. 高度な原因より、単純なミスを疑え
「非同期処理の競合」のような難しいバグを疑う前に、「命名規則」や「タイプミス」などの基本的な設定ミスを疑うリストを持つべき。

---

## 🎨 Gemini用 図解プロンプト

この学びを視覚的に保存するためのGemini用プロンプト。

```markdown
以下のトラブルシューティングの教訓を、「開発の落とし穴と脱出ルート」として図解してください。

## テーマ
「Remotionの画面が真っ黒！原因はコードではなく『ID名』だった」

## 図解の構成要素
1. **左側：迷宮（Trap）**
   - 状況: ブラウザのプレビュー画面が真っ黒 (Black Screen)。
   - 思考の罠: 「フォント読み込みのバグかな？」「重すぎるのかな？」とコード内部を疑って修正し続ける（泥沼）。
   - 結果: 直らない、エラーも出ない（サイレントクラッシュ）。

2. **中央：壁 (The Wall)**
   - 原因: Composition ID に「_ (アンダースコア)」を使っていた。
   - ルール: Remotionはハイフン「-」はOKだが、アンダースコアはNG。

3. **右側：脱出ルート (Solution)**
   - 解決策: ターミナルで `npx remotion render` を実行。
   - 効果: ブラウザでは見えなかった「IDエラー」が文字でハッキリ表示される。
   - 教訓: 「UIが死んだら、CUI（ターミナル）に聞け」。

## ビジュアルイメージ
- 親しみやすい手書き風のフローチャート。
- 開発者（自分）が左側で頭を抱え、右側でターミナル画面を見て「Aha!」となっている様子。
- 重要キーワード：「Silence is Trap (沈黙は罠)」「Ask the CLI (コマンドラインに聞け)」を目立たせる。
```
